# 🛡️ AI语音政治风险监控系统 - 安全强化配置
# 全方位安全防护和威胁检测

security:
  # 🔐 身份认证和授权
  authentication:
    # JWT配置
    jwt:
      secret_key: ${JWT_SECRET_KEY}
      algorithm: "HS256"
      access_token_expire_minutes: 30
      refresh_token_expire_days: 7
      issuer: "audio-ai-system"
      audience: "audio-ai-users"
    
    # 多因素认证 (2FA)
    two_factor:
      enabled: true
      issuer_name: "AI Audio Risk Monitor"
      totp_validity_window: 30
      backup_codes_count: 10
    
    # OAuth 2.0 集成
    oauth:
      google:
        client_id: ${GOOGLE_CLIENT_ID}
        client_secret: ${GOOGLE_CLIENT_SECRET}
        redirect_uri: "/auth/google/callback"
      
      microsoft:
        client_id: ${MICROSOFT_CLIENT_ID}
        client_secret: ${MICROSOFT_CLIENT_SECRET}
        redirect_uri: "/auth/microsoft/callback"
    
    # 密码策略
    password_policy:
      min_length: 12
      require_uppercase: true
      require_lowercase: true
      require_numbers: true
      require_special_chars: true
      max_age_days: 90
      history_count: 12
      
  # 🚫 访问控制
  access_control:
    # 基于角色的访问控制 (RBAC)
    rbac:
      roles:
        admin:
          permissions:
            - "system:*"
            - "user:*"
            - "audio:*"
            - "model:*"
            - "config:*"
        
        analyst:
          permissions:
            - "audio:read"
            - "audio:analyze"
            - "report:read"
            - "report:create"
        
        operator:
          permissions:
            - "audio:upload"
            - "audio:read"
            - "task:read"
        
        viewer:
          permissions:
            - "audio:read"
            - "report:read"
    
    # IP白名单
    ip_whitelist:
      enabled: false
      allowed_ips:
        - "192.168.1.0/24"
        - "10.0.0.0/8"
        - "172.16.0.0/12"
    
    # API限流
    rate_limiting:
      global:
        requests_per_minute: 1000
        requests_per_hour: 10000
      
      per_user:
        requests_per_minute: 100
        requests_per_hour: 1000
      
      upload:
        files_per_hour: 50
        max_file_size_mb: 100
  
  # 🔍 威胁检测
  threat_detection:
    # 异常行为检测
    anomaly_detection:
      enabled: true
      
      # 登录异常
      login_anomalies:
        max_failed_attempts: 5
        lockout_duration_minutes: 30
        unusual_location_threshold: 1000  # km
        unusual_time_threshold: 6  # hours outside normal pattern
      
      # 使用模式异常
      usage_anomalies:
        max_requests_per_minute: 200
        unusual_upload_pattern_threshold: 0.8
        suspicious_file_types: [".exe", ".bat", ".sh", ".ps1"]
    
    # 恶意文件检测
    malware_detection:
      enabled: true
      scan_uploads: true
      quarantine_suspicious: true
      
      # 文件类型检查
      allowed_extensions: [".wav", ".mp3", ".flac", ".m4a", ".aac", ".ogg"]
      max_file_size_mb: 100
      
      # 病毒扫描
      antivirus:
        engine: "clamav"
        update_signatures: true
        scan_timeout_seconds: 300
    
    # 网络安全
    network_security:
      # DDoS防护
      ddos_protection:
        enabled: true
        threshold_requests_per_second: 100
        block_duration_minutes: 60
      
      # SQL注入防护
      sql_injection_protection:
        enabled: true
        patterns:
          - "union.*select"
          - "drop.*table"
          - "insert.*into"
          - "delete.*from"
      
      # XSS防护
      xss_protection:
        enabled: true
        content_security_policy: "default-src 'self'; script-src 'self' 'unsafe-inline'"
  
  # 🔒 数据加密
  encryption:
    # 传输加密
    transport:
      tls_version: "1.3"
      cipher_suites:
        - "TLS_AES_256_GCM_SHA384"
        - "TLS_CHACHA20_POLY1305_SHA256"
        - "TLS_AES_128_GCM_SHA256"
      
      # HSTS配置
      hsts:
        enabled: true
        max_age_seconds: 31536000
        include_subdomains: true
        preload: true
    
    # 静态数据加密
    data_at_rest:
      algorithm: "AES-256-GCM"
      key_rotation_days: 90
      
      # 数据库加密
      database:
        encrypt_connections: true
        encrypt_backups: true
        field_level_encryption:
          - "user_personal_info"
          - "audio_transcripts"
          - "analysis_results"
      
      # 文件系统加密
      filesystem:
        encrypt_uploads: true
        encrypt_cache: true
        encrypt_logs: false  # 日志可能需要实时分析
  
  # 📊 安全审计
  audit:
    # 日志记录
    logging:
      enabled: true
      level: "INFO"
      
      # 审计事件
      events:
        - "user_login"
        - "user_logout"
        - "permission_change"
        - "file_upload"
        - "file_download"
        - "api_access"
        - "admin_action"
        - "security_alert"
      
      # 日志保留
      retention:
        security_logs_days: 365
        access_logs_days: 90
        error_logs_days: 180
    
    # 合规性
    compliance:
      # GDPR
      gdpr:
        enabled: true
        data_retention_days: 730
        anonymization_enabled: true
        right_to_be_forgotten: true
      
      # SOC 2
      soc2:
        enabled: true
        continuous_monitoring: true
        automated_reports: true
  
  # 🚨 事件响应
  incident_response:
    # 自动响应
    automated_response:
      enabled: true
      
      # 账户锁定
      account_lockout:
        trigger: "multiple_failed_logins"
        duration_minutes: 30
        notification: true
      
      # IP封禁
      ip_blocking:
        trigger: "suspicious_activity"
        duration_minutes: 60
        whitelist_bypass: false
      
      # 服务隔离
      service_isolation:
        trigger: "security_breach"
        isolate_affected_nodes: true
        maintain_core_services: true
    
    # 通知机制
    notifications:
      channels:
        email:
          enabled: true
          recipients: ["security@company.com"]
          severity_threshold: "medium"
        
        slack:
          enabled: true
          webhook_url: ${SLACK_WEBHOOK_URL}
          channel: "#security-alerts"
          severity_threshold: "high"
        
        sms:
          enabled: false
          provider: "twilio"
          numbers: ["+1234567890"]
          severity_threshold: "critical"
  
  # 🔧 安全配置
  hardening:
    # 系统强化
    system:
      disable_unnecessary_services: true
      remove_default_accounts: true
      secure_boot_enabled: true
      
      # 文件权限
      file_permissions:
        config_files: "600"
        log_files: "640"
        executable_files: "755"
        data_directories: "750"
    
    # 应用强化
    application:
      disable_debug_mode: true
      remove_development_endpoints: true
      secure_headers: true
      
      # HTTP安全头
      security_headers:
        x_content_type_options: "nosniff"
        x_frame_options: "DENY"
        x_xss_protection: "1; mode=block"
        strict_transport_security: "max-age=31536000; includeSubDomains"
        content_security_policy: "default-src 'self'"
    
    # 网络强化
    network:
      disable_unnecessary_ports: true
      configure_firewall: true
      enable_intrusion_detection: true
      
      # 防火墙规则
      firewall_rules:
        - name: "allow_http"
          port: 80
          protocol: "tcp"
          source: "any"
        
        - name: "allow_https"
          port: 443
          protocol: "tcp"
          source: "any"
        
        - name: "allow_ssh"
          port: 22
          protocol: "tcp"
          source: "management_network"
        
        - name: "deny_all"
          action: "deny"
          source: "any"
          destination: "any"

# 🔍 安全监控仪表板配置
monitoring:
  metrics:
    - name: "failed_login_attempts"
      type: "counter"
      description: "失败登录尝试次数"
    
    - name: "suspicious_file_uploads"
      type: "counter"
      description: "可疑文件上传次数"
    
    - name: "security_alerts_generated"
      type: "counter"
      description: "生成的安全警报数量"
    
    - name: "blocked_ip_addresses"
      type: "gauge"
      description: "当前被封禁的IP地址数量"
    
    - name: "active_security_sessions"
      type: "gauge"
      description: "当前活跃的安全会话数量"
